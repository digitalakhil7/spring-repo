## Securing URLs using SecurityFilterChain and Authentication using CustomUserDetailsService
### Entity class
```java
@Entity
@Table(name = "user")
@Data
@NoArgsConstructor
@AllArgsConstructor
public class UserEntity {
	@Id
	private String username;
	private String password;
	private String role;
}
```
### Repo
```java
@Repository
public interface UserRepo extends JpaRepository<UserEntity, String> {

}
```
### CustomUserDetailsService
```java
@Service
public class CustomUserDetailsService implements UserDetailsService {
	
	@Autowired
	private UserRepo repo;

	@Override
	public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
		UserEntity user = repo.findById(username).orElseThrow
		(() -> new UsernameNotFoundException("user not found with username: "+username));
		return User.withUsername(user.getUsername())
				.password(user.getPassword())
				.roles(user.getRole())
				.build();
	}

}
```
### SecurityConfig
```java
import static org.springframework.security.config.Customizer.withDefaults;
@Configuration
public class SecurityConfig {
	
	@Autowired
	private CustomUserDetailsService userDetailsService;
		
    @Bean
    SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http) {
        http
        .csrf(csrf -> csrf.disable())
        .authorizeHttpRequests((requests) -> requests
                .requestMatchers("/home", "/about", "/register").permitAll()
                .anyRequest().authenticated()
        );
        http.userDetailsService(userDetailsService);
        http.formLogin(withDefaults());
        http.httpBasic(withDefaults());
        return http.build();
    }
    
    
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
    
}
```
### RestController
```java
@RestController
public class MyController {
	
	@Autowired
	private UserRepo repo;
	
	@Autowired
	private PasswordEncoder encoder;
	
	// Unprotected APIs
	@PostMapping("/register")
	public ResponseEntity<String> registerUser(@RequestBody UserEntity user){
		user.setPassword(encoder.encode(user.getPassword()));
		repo.save(user);
		
		return new ResponseEntity<>("User registered", HttpStatus.CREATED);
	}
	
	@GetMapping("/home")
	public ResponseEntity<String> getHome() {
		return new ResponseEntity<String>("Home", HttpStatus.OK);
	}
	
	@GetMapping("/about")
	public ResponseEntity<String> getAbout() {
		return new ResponseEntity<String>("About", HttpStatus.OK);
	}
	
	// Protected APIs
	@GetMapping("/landing")
	public ResponseEntity<String> getLanding() {
		return new ResponseEntity<String>("Landing", HttpStatus.OK);
	}
	
	@GetMapping("/approve")
	public ResponseEntity<String> getApprove() {
		return new ResponseEntity<String>("Approve", HttpStatus.OK);
	}
	
}
```
